<!DOCTYPE html>
<html>
<head>
    <title>Stockfish V3 Debugger</title>
</head>
<body>
    <h1>Stockfish Logic Debugger</h1>
    <p>Check the <b>Console (F12)</b> to see the engine's raw thoughts.</p>
    <button onclick="testEngine()">Run 1-Move Test</button>
    <div id="output" style="white-space: pre; font-family: monospace; background: #eee; padding: 10px; margin-top: 10px;"></div>

    <script>
        const outputDiv = document.getElementById('output');
        const engine = new Worker('stockfish.js'); // Ensure this file is in the same folder!

        let lastScore = "None";

        engine.onmessage = function(event) {
            const line = event.data;
            console.log("RAW ENGINE:", line);
            outputDiv.innerText += line + "\n";

            // Logic to grab the score
            if (line.includes("score cp")) {
                const parts = line.split(" ");
                lastScore = parts[parts.indexOf("cp") + 1];
            }

            if (line.startsWith("bestmove")) {
                console.warn(">>> FINAL SCORE CAPTURED:", lastScore);
                alert("Test Complete. Last Score: " + lastScore + "\nCheck console for details.");
            }
        };

        function testEngine() {
            outputDiv.innerText = "";
            console.log("--- STARTING TEST ---");
            engine.postMessage('uci');
            engine.postMessage('isready');
            engine.postMessage('ucinewgame');
            // Testing a common position: 1. e4 e5
            engine.postMessage('position startpos moves e2e4 e7e5');
            // 'movetime 1000' forces it to think for 1 second so it GIVES a score
            engine.postMessage('go movetime 1000');
        }
    </script>
</body>
</html>
